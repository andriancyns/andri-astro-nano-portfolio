---
interface Props {
  type: 'website' | 'person' | 'article' | 'breadcrumb';
  title?: string;
  description?: string;
  url?: string;
  image?: string;
  datePublished?: string | Date;
  dateModified?: string | Date;
  author?: string;
  readingTime?: string;
  wordCount?: number;
  tags?: string[];
  breadcrumbItems?: Array<{name: string, url: string}>;
}

const { type, title, description, url, image, datePublished, dateModified, author, readingTime, wordCount, tags, breadcrumbItems } = Astro.props;

const siteUrl = Astro.site?.href || 'https://cyns.space';
const currentUrl = new URL(Astro.url.pathname, siteUrl).href;

let structuredData = {};

if (type === 'website') {
  structuredData = {
    "@context": "https://schema.org",
    "@type": "WebSite",
    "name": "Andrianto Cahyono Putro",
    "alternateName": "Andrian",
    "url": siteUrl,
    "description": description || "Software Engineer specializing in backend (Go/Laravel) and mobile apps frontend (Android Java/Kotlin & Flutter). Builds backend-heavy, scalable, production-ready systems.",
    "author": {
      "@type": "Person",
      "name": "Andrianto Cahyono Putro",
      "alternateName": "Andrian",
      "url": siteUrl,
      "jobTitle": "Software Engineer",
      "worksFor": {
        "@type": "Organization",
        "name": "Freelancer"
      },
      "knowsAbout": ["Software Engineering", "Backend Development", "Mobile Development", "Go", "Laravel", "Android", "Flutter"],
      "sameAs": [
        "https://github.com/andriancyns",
        "https://www.linkedin.com/in/andriancyns",
        "https://www.instagram.com/andriancyns",
        "https://dribbble.com/andriancyns",
        "https://andriancyns.contra.com/"
      ]
    }
  };
} else if (type === 'person') {
  structuredData = {
    "@context": "https://schema.org",
    "@type": "Person",
    "name": "Andrianto Cahyono Putro",
    "alternateName": "Andrian",
    "url": siteUrl,
    "image": image || `${siteUrl}/astro-nano.png`,
    "jobTitle": "Software Engineer",
    "worksFor": {
      "@type": "Organization",
      "name": "Freelancer"
    },
    "knowsAbout": ["Software Engineering", "Backend Development", "Mobile Development", "Go", "Laravel", "Android", "Flutter"],
    "sameAs": [
      "https://github.com/andriancyns",
      "https://www.linkedin.com/in/andriancyns",
      "https://www.instagram.com/andriancyns",
      "https://dribbble.com/andriancyns",
      "https://andriancyns.contra.com/"
    ],
    "email": "andriancyns@gmail.com"
  };
} else if (type === 'article') {
  structuredData = {
    "@context": "https://schema.org",
    "@type": "BlogPosting",
    "headline": title,
    "description": description,
    "url": currentUrl,
    "datePublished": datePublished,
    "dateModified": dateModified || datePublished,
    "author": {
      "@type": "Person",
      "name": author || "Andrianto Cahyono Putro",
      "url": siteUrl,
      "jobTitle": "Software Engineer"
    },
    "publisher": {
      "@type": "Person",
      "name": "Andrianto Cahyono Putro",
      "url": siteUrl
    },
    "mainEntityOfPage": {
      "@type": "WebPage",
      "@id": currentUrl
    },
    "inLanguage": "id-ID"
  };

  if (image) {
    structuredData.image = {
      "@type": "ImageObject",
      "url": new URL(image, siteUrl).href
    };
  }

  if (readingTime) {
    structuredData.timeRequired = readingTime;
  }

  if (wordCount) {
    structuredData.wordCount = wordCount;
  }

  if (tags && tags.length > 0) {
    structuredData.keywords = tags.join(", ");
    structuredData.about = tags.map(tag => ({
      "@type": "Thing",
      "name": tag
    }));
  }
} else if (type === 'breadcrumb' && breadcrumbItems) {
  structuredData = {
    "@context": "https://schema.org",
    "@type": "BreadcrumbList",
    "itemListElement": breadcrumbItems.map((item, index) => ({
      "@type": "ListItem",
      "position": index + 1,
      "name": item.name,
      "item": new URL(item.url, siteUrl).href
    }))
  };
}
---

{structuredData && Object.keys(structuredData).length > 0 && (
  <script type="application/ld+json" set:html={JSON.stringify(structuredData)} />
)}

{/* Add breadcrumb schema separately if it's an article or project page */}
{(type === 'article') && breadcrumbItems && (
  <script type="application/ld+json" set:html={JSON.stringify({
    "@context": "https://schema.org",
    "@type": "BreadcrumbList",
    "itemListElement": breadcrumbItems.map((item, index) => ({
      "@type": "ListItem",
      "position": index + 1,
      "name": item.name,
      "item": new URL(item.url, siteUrl).href
    }))
  })} />
)}